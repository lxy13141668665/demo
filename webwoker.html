<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width" />
  <title>MDN Example - Embedded worker</title>
  <script type="text/js-worker">
      // 该脚本不会被 JS 引擎解析，因为它的 mime-type 是 text/js-worker。
      const myVar = 'Hello World!';
      // 剩下的 worker 代码写到这里。
    </script>
  <script>
    // 该脚本会被 JS 引擎解析，因为它的 mime-type 是 text/javascript。
    function pageLog(sMsg) {
      // 使用 fragment：这样浏览器只会进行一次渲染/重排。
      const frag = document.createDocumentFragment();
      frag.appendChild(document.createTextNode(sMsg));
      frag.appendChild(document.createElement("br"));
      document.querySelector("#logDisplay").appendChild(frag);
    }
  </script>
  <script type="text/js-worker">
      // 该脚本不会被 JS 引擎解析，因为它的 mime-type 是 text/js-worker。
      onmessage = (event) => {
        postMessage(myVar);
      };
      // 剩下的 worker 代码写到这里。
    </script>
  <script>
    // 该脚本会被 JS 引擎解析，因为它的 mime-type 是 text/javascript。

    // 过去存在 blob builder，但现在我们使用Blob
    const blob = new Blob(
      Array.prototype.map.call(
        document.querySelectorAll("script[type='text\/js-worker']"),
        (script) => script.textContent,
        { type: "text/javascript" }
      )
    );

    // 创建一个新的 document.worker 属性，包含所有 "text/js-worker" 脚本。
    document.worker = new Worker(window.URL.createObjectURL(blob));

    document.worker.onmessage = (event) => {
      pageLog(`Received: ${event.data}`);
    };

    // 启动 worker。
    window.onload = () => {
      document.worker.postMessage("");
    };
  </script>
</head>
<body>
<div id="logDisplay"></div>
</body>
</html>