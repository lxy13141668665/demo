<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
     <script type="text/javascript" src="jquery-1.7.2.min.js"></script> 
    <!--<script type="text/javascript" src="jquery.min.js"></script>-->
    <script type="text/javascript" src="ServicePage.aspx?js=1"></script>
    <title></title>
</head>
<body>
    <div>
        <input type="button" value="获取全文档痕迹列表" onclick="exp();" />
        <input type="button" value="获取子文档1痕迹列表" onclick="exp(1);" />
        <input type="button" value="获取子文档2痕迹列表" onclick="exp(2);" />
    </div>

    <div id="myWriterControl" style="width: 100%; border: 2px solid black; border-radius: 5px;height:900px;"
         LocalServerPort="2345"
         TransformUseBase64="false"
         FieldBorderPrintVisibility="None"
         FormView="Disable"
         ReadOnly="false"
         PreviewUseAdvancedLayout="false"
         BackgroundTextOutputMode="Underline"
         contentrendermode="NormalHTMLEditable"
         AutoSaveIntervalInSecond="0"
         workspacebackcolorstring="#B1CAEB"
         servicepageurl="ServicePage.aspx"
         useclassattribute="false"
         heightcompress="true"
         imagedataembedinhtml="true"
         ExcludeLogicDeleted="false"
         HeaderFooterEditable="true"
         UseDCWriterMiniJS="false"
         serversleepfordebug="0"
         allowcopy="true"
         supportactivex="false"
         pixelpagespacing="5"
         clientcontextmenutype="Custom"
         showdebuginfo="false"
         ismobiledevice="False"
         IndentHtmlCode="false"
         FreeSelection="true"
         urlencodecountforpostdata="0"
         AutoZoom="false"
         registercodeindex="0" />


    <script type="text/javascript">
        // HTML页面加载后执行本函数
        function BuildDCWriterControlFrame() {
            // 获得控件容器元素
            var ctl = document.getElementById("myWriterControl");
            // 绑定控件
            BindingDCWriterClientControl(ctl);

            ctl.Options.LogUserEditTrack = true;
            ctl.Options.CurrentUserID = "zhangsan";
            ctl.Options.CurrentUserName = "张三主任医师";
            ctl.Options.CurrentUserPermissionLevel = "2";
            ctl.Options.ClientMachineName = "123";
            ctl.Options.ExcludeLogicDeleted = false;
            ctl.DocumentOptions.SecurityOptions.EnablePermission = true;
            ctl.DocumentOptions.SecurityOptions.EnableLogicDelete = true;
            ctl.DocumentOptions.SecurityOptions.ShowLogicDeletedContent = true;
            ctl.DocumentOptions.SecurityOptions.ShowPermissionMark = true;
            ctl.DocumentOptions.SecurityOptions.ShowPermissionTip = true;

            ctl.Options.OutputOriginUserTrackInfos = true;

            // 创建编辑器框架
            ctl.BuildFrame(function () {
                ctl.LoadDocumentFromString(xmlforload, "xml");
            });
        }
        BuildDCWriterControlFrame();


        function exp(parameter) {
            var ctl = document.WriterControl;
            var doc = ctl.GetContentDocument();
            var subdoc = null;
            if (parameter === 1) {
                subdoc = doc.getElementById("subdoc1");
            } else if (parameter === 2) {
                subdoc = doc.getElementById("subdoc2");
            }
            if (subdoc == null) {
                console.log(ctl.GetDocumentUserTrackInfos());
            } else {
                console.log(ctl.GetDocumentUserTrackInfos(null,subdoc));
            }
        }

        var xmlforload = `<XTextDocument xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" EditorVersionString="1.2023.1.10">
   <InnerID>165</InnerID>
   <XElements>
      <Element xsi:type="XTextHeader">
         <InnerID>3699</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag" StyleIndex="0">
               <InnerID>3704</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextBody">
         <InnerID>3700</InnerID>
         <AcceptTab>true</AcceptTab>
         <ContentReadonly>False</ContentReadonly>
         <XElements>
            <Element xsi:type="XString">
               <InnerID>189</InnerID>
               <Text>asfasdfsdafasdfasdfasdfCCCCCCCC</Text>
            </Element>
            <Element xsi:type="XString" StyleIndex="2">
               <InnerID>190</InnerID>
               <Text>CCCCCCCCC</Text>
            </Element>
            <Element xsi:type="XString">
               <InnerID>191</InnerID>
               <Text>CCCCCCCC</Text>
            </Element>
            <Element xsi:type="XParagraphFlag">
               <InnerID>3735</InnerID>
            </Element>
            <Element xsi:type="XTextSubDocument" StyleIndex="1">
               <InnerID>3736</InnerID>
               <ID>subdoc1</ID>
               <AcceptTab>true</AcceptTab>
               <EnablePermission>True</EnablePermission>
               <ContentReadonly>False</ContentReadonly>
               <XElements>
                  <Element xsi:type="XString">
                     <InnerID>195</InnerID>
                     <Text>这是一段新的病程记录AAAA</Text>
                  </Element>
                  <Element xsi:type="XString" StyleIndex="2">
                     <InnerID>196</InnerID>
                     <Text>AAAAAAA</Text>
                  </Element>
                  <Element xsi:type="XString">
                     <InnerID>197</InnerID>
                     <Text>AAAAAAA</Text>
                  </Element>
                  <Element xsi:type="XParagraphFlag">
                     <InnerID>3747</InnerID>
                     <AutoCreate>true</AutoCreate>
                  </Element>
               </XElements>
               <ForeColorForCollapsed />
               <ForeColorValueForCollapsed>#00000000</ForeColorValueForCollapsed>
               <DocumentInfo>
                  <Title>病程记录2023年02月23日 09时27分18秒</Title>
                  <CreationTime>1980-01-01T00:00:00</CreationTime>
                  <LastModifiedTime>1980-01-01T00:00:00</LastModifiedTime>
                  <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
                  <Author>DCSOFTWU</Author>
                  <Operator>DCSoft.Writer Version:1.2023.1.10</Operator>
               </DocumentInfo>
               <FileName>D:\Winform演示程序2023年1月\Debug\DemoFile\病程记录内容\病程记录2023年02月23日 09时27分18秒.xml</FileName>
            </Element>
            <Element xsi:type="XTextSubDocument" StyleIndex="1">
               <ID>subdoc2</ID>
               <InnerID>3748</InnerID>
               <AcceptTab>true</AcceptTab>
               <EnablePermission>True</EnablePermission>
               <ContentReadonly>False</ContentReadonly>
               <XElements>
                  <Element xsi:type="XString">
                     <InnerID>198</InnerID>
                     <Text>这是一段新的病程记录BBBBB</Text>
                  </Element>
                  <Element xsi:type="XString" StyleIndex="2">
                     <InnerID>199</InnerID>
                     <Text>BBBBBBBB</Text>
                  </Element>
                  <Element xsi:type="XString">
                     <InnerID>200</InnerID>
                     <Text>BBBBBBBBBB</Text>
                  </Element>
                  <Element xsi:type="XParagraphFlag">
                     <InnerID>3759</InnerID>
                     <AutoCreate>true</AutoCreate>
                  </Element>
               </XElements>
               <ForeColorForCollapsed />
               <ForeColorValueForCollapsed>#00000000</ForeColorValueForCollapsed>
               <DocumentInfo>
                  <Title>病程记录2023年02月23日 09时27分21秒</Title>
                  <CreationTime>1980-01-01T00:00:00</CreationTime>
                  <LastModifiedTime>1980-01-01T00:00:00</LastModifiedTime>
                  <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
                  <Author>DCSOFTWU</Author>
                  <Operator>DCSoft.Writer Version:1.2023.1.10</Operator>
               </DocumentInfo>
               <FileName>D:\Winform演示程序2023年1月\Debug\DemoFile\病程记录内容\病程记录2023年02月23日 09时27分21秒.xml</FileName>
            </Element>
            <Element xsi:type="XString" StyleIndex="1">
               <InnerID>192</InnerID>
               <Text>sdfasdfsafasfsdafasdfasdfdDDDDD</Text>
            </Element>
            <Element xsi:type="XString" StyleIndex="3">
               <InnerID>193</InnerID>
               <Text>DDDDDDDD</Text>
            </Element>
            <Element xsi:type="XString" StyleIndex="1">
               <InnerID>194</InnerID>
               <Text>DDDDDDDDDDDDD</Text>
            </Element>
            <Element xsi:type="XParagraphFlag">
               <InnerID>3705</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextFooter">
         <InnerID>3701</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag">
               <InnerID>3706</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
   </XElements>
   <Parameters>
      <Parameter Name="当前时间" />
   </Parameters>
   <FileFormat>XML</FileFormat>
   <UserHistories>
      <History>
         <ID>li</ID>
         <Name>李医师</Name>
         <SavedTime>2023-02-23T09:35:45.6657929+08:00</SavedTime>
         <PermissionLevel>1</PermissionLevel>
      </History>
      <History>
         <ID>li</ID>
         <Name>李医师</Name>
         <SavedTime>1980-01-01T00:00:00</SavedTime>
         <PermissionLevel>1</PermissionLevel>
      </History>
   </UserHistories>
   <ContentStyles>
      <Default xsi:type="DocumentContentStyle">
         <FontName>宋体</FontName>
         <FontSize>12</FontSize>
      </Default>
      <Styles>
         <Style Index="0">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <Align>Center</Align>
         </Style>
         <Style Index="1">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <PrintBackColor>#00FFFFFF</PrintBackColor>
         </Style>
         <Style Index="2">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <DeleterIndex>0</DeleterIndex>
         </Style>
         <Style Index="3">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <PrintBackColor>#00FFFFFF</PrintBackColor>
            <DeleterIndex>0</DeleterIndex>
         </Style>
      </Styles>
   </ContentStyles>
   <Info>
      <LicenseText>南京都昌信息科技有限公司内部使用:南京都昌信息科技有限公司内测旗舰版</LicenseText>
      <CreationTime>2023-02-23T09:27:13.085203+08:00</CreationTime>
      <LastModifiedTime>2023-02-23T09:35:45.6657929+08:00</LastModifiedTime>
      <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
      <Operator>DCSoft.Writer Version:1.2023.1.10</Operator>
      <NumOfPage>1</NumOfPage>
   </Info>
   <BodyText>asfasdfsdafasdfasdfasdfCCCCCCCCCCCCCCCC
这是一段新的病程记录AAAAAAAAAAA这是一段新的病程记录BBBBBBBBBBBBBBBsdfasdfsafasfsdafasdfasdfdDDDDDDDDDDDDDDDDDD</BodyText>
   <LocalConfig />
   <PageSettings>
      <StrictUsePageSize>false</StrictUsePageSize>
   </PageSettings>
</XTextDocument>
`;

    </script>
</body>
</html>