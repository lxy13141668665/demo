<!DOCTYPE html >
<html>
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

    <title>表格数据源绑定图片测试页</title>
    <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="ServicePage.aspx?js=1"></script>
    <style>
        html, body {
            height: 100%;

        }
    </style>
</head>
<body style="overflow: hidden;">
    <input type="button" value="1.加载文档" onclick="exp();" />
    <input type="button" value="2.绑定数据显示" onclick="exp7adv();" />
    <input type="button" value="3.插入下拉列表输入域元素并绑定" onclick="insertDropdownListInputText();" />


    <div id="myWriterControl"
         style="width: 100%; height: 100%"
         contentrendermode="NormalHtmlEditable"
         workspacebackcolorstring="#F1F3F5"
         useclassattribute="false"
         FormView="Disabled"
         ClientContextMenuType="Custom"
         UseDCWriterMiniJS="false"
         LogUserEditTrack="false"
         heightcompress="true"
         backgroundtextoutputmode="None"
         imagedataembedinhtml="true"
         serversleepfordebug="0"
         ShowPageBorderLine="false"
         allowcopy="true"
         supportactivex="false"
         pixelpagespacing="1"
         showdebuginfo="false"
         HeaderFooterEditable="true"
         registercodeindex="0"
         fileprintautoclose="false"
         servicepageurl="ServicePage.aspx">

    </div>
    <script type="text/javascript">

        // 获得控件容器元素
        var ctl = document.getElementById("myWriterControl");

        // 绑定控件
        BindingDCWriterClientControl(ctl);

        // 创建编辑器框架
        ctl.BuildFrame(function () {
            //ctl.LoadDocumentFromString(saveString, "xml");
            //menu()
        });



        function exp() {
            var ctl = document.WriterControl;
            ctl.LoadDocumentFromString(data, "xml");
        }

        function exp7adv() {
            var ctl = document.getElementById("myWriterControl");
            if (ctl != null) {

                var values = {
                    pathv: "值2",
                    patht: "文本2"
                };
                
                ctl.SetDocumentParameterValue("source", values);//EMR_Patients
                ctl.WriteDataFromDataSourceToDocument();
            }
        }

        ctl.DocumentLoad = function () {
            // 文档加载成功事件

            //动态下拉
            ctl.EventQueryListItems = eventQueryList;
        }

        var data = `<XTextDocument xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" EditorVersionString="0.0.0.0">
   <XElements>
      <Element xsi:type="XTextHeader">
         <InnerID>1</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag" StyleIndex="0">
               <InnerID>6</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextBody">
         <InnerID>2</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XInputField">
               <InnerID>12</InnerID>
               <ID>field1</ID>
               <EnableValueValidate>true</EnableValueValidate>
               <ValueBinding>
                  <DataSource>source</DataSource>
                  <BindingPath>pathv</BindingPath>
                  <BindingPathForText>patht</BindingPathForText>
               </ValueBinding>
               <BorderElementColor />
               <BackgroundText>下拉域</BackgroundText>
               <FieldSettings>
                  <EditStyle>DropdownList</EditStyle>
                  <ListSource>
                     <Items>
                        <Item>
                           <Text>文本1</Text>
                           <Value>值1</Value>
                        </Item>
                        <Item>
                           <Text>文本2</Text>
                           <Value>值2</Value>
                        </Item>
                        <Item>
                           <Text>文本3</Text>
                           <Value>值3</Value>
                        </Item>
                        <Item>
                           <Text>文本4</Text>
                           <Value>值4</Value>
                        </Item>
                     </Items>
                  </ListSource>
               </FieldSettings>
            </Element>
            <Element xsi:type="XParagraphFlag">
               <InnerID>7</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextFooter">
         <InnerID>3</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag">
               <InnerID>8</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
   </XElements>
   <FileName>C:\Users\DCSOFTWU\Desktop\玉玉.xml</FileName>
   <FileFormat>XML</FileFormat>
   <ContentStyles>
      <Default xsi:type="DocumentContentStyle">
         <FontSize>12</FontSize>
      </Default>
      <Styles>
         <Style Index="0">
            <FontSize>12</FontSize>
            <Align>Center</Align>
         </Style>
      </Styles>
   </ContentStyles>
   <Info>
      <LicenseText>南京都昌信息科技有限公司:南京都昌信息科技有限公司内测版</LicenseText>
      <CreationTime>2022-09-26T13:43:47.664335+08:00</CreationTime>
      <LastModifiedTime>2022-09-26T13:46:38.5350033+08:00</LastModifiedTime>
      <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
      <Operator>DCSoft.Writer Version:0.0.0.0</Operator>
      <NumOfPage>1</NumOfPage>
   </Info>
   <LocalConfig />
   <PageSettings>
      <StrictUsePageSize>false</StrictUsePageSize>
   </PageSettings>
</XTextDocument>`;


        function eventQueryList(object) {
            console.log(object);

            if (object.ListSourceName == "DropdownList") {
                object.AddResultItemByTextValue("中国", "CN");
                object.AddResultItemByTextValue("美国", "AM");
            } else {
                object.AddResultItemByTextValue("选项1", "option1");
                object.AddResultItemByTextValue("选项2", "option2");
            }
        }

        function insertDropdownListInputText() {

            // 插入下拉列表文本输入域            
            let options = {
                "InnerEditStyle": "DropdownList",
                "EditorActiveMode": "MouseClick",
                "Innerlistsourcename": "DropdownList",
                "BackgroundText": "下拉列表文本输入域",
                "ToolTip": "下拉列表文本输入域",
                "LabelText": "下拉列表文本输入域:",
                "UnitText": "单位",
                "Text": "美国",
                "InnerValue": "AM",
                "StartBorderText": "[",
                "EndBorderText": "]",
                "Alignment": "Far",
                "ContentReadonly": false,
                "Deleteable": true,
                "Datasource": "TestDataSet",
                "BindingPath": "TestDropdownListValue",
                "BindingPathForText": "TestDropdownListText"
            };

            let textField = ctl.DCExecuteCommand("InsertInputField", false, options);

            let testDataSet = {
                "TestDropdownListText": "中国",
                "TestDropdownListValue": "CN"
            };

            // 说明
            // 第一个参数为数据源名称
            // 第二个参数为数据源的值
            // 如果有多个数据源可以调用多次SetDocumentParameterValue方法,来设置多个不同的数据源
            // 无返回值
            let datasource = ctl.SetDocumentParameterValue("TestDataSet", testDataSet);

            // 说明
            // 将数据源中的数据写入文档中
            // 返回更新了多少个元素
            let writerResult = ctl.WriteDataFromDataSourceToDocument();
        }
    </script>

</body>
</html>