<!DOCTYPE html>
<html>
<head>
    
    <meta charset="utf-8" />
    <title></title>
    <style>
        html, body {
            height:100%;
            overflow:hidden;
        }
    </style>
</head>
<body>
    <input type="button" value="本地文档加载" onclick="document.getElementById('myWriterControl').DCExecuteCommand('FileOpen', true, null);" />
    <button onclick="save();">保存病程</button>
    <button onclick="insert();">加载病程</button>
    <div id="myWriterControl" style="width: 100%;height:785px; border: 2px solid black; border-radius: 5px" excludekeywords="出生"
         workspacebackcolorstring="#B1CAEB" imagedataembedinhtml="true" usedcwriterminijs="true" ContentRenderMode="NormalHtmlEditable"
         ClientContextMenuType="Custom" servicepageurl="ServicePage.aspx" fileprintautoclose="false" AutoZoom="false" useclassattribute="true" autozoom2="true"
         UrlEncodeCountForPostData=0 LogUserEditTrack=false DocumentOptions.BehaviorOptions.AcceptDataFormats=All
         DocumentOptions.BehaviorOptions.WordBreak="true">
    </div>
    <!-- 必须先完成才能有window上才会有BindingDCWriterClientControl方法,才能绑定编辑器成功 -->
    <script type="text/javascript" src="jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="ServicePage.aspx?js=1"></script>
    <script type="text/javascript">
        var ctl = document.getElementById("myWriterControl");
        BindingDCWriterClientControl(ctl) // 绑定控件
        ctl.BuildFrame(function () {
            if (ctl != null) {
                ctl.GetContentContainer().focus();
                //ctl.LoadDocumentFromString(xml6, 'xml')
            }
        });

        ctl.DocumentLoad = function () {
        }

        function save() {
            //获取所有病程
            var arr = ctl.GetCourseRecords();
            //保存单个病程
            var subid = arr[0].ElementID;
            if (subid) {
                var options = {
                    "FileFormat": "xml",//文档格式
                    "SubDocID": subid,// 病程id
                    "UseBase64": false,//  是否保存回BASE64字符串
                    "CommitUserTrace": false, //是否生成提交所有文档痕迹后的内容
                    "OutputFormatXML": true,// 是否输出带格式的XML
                    "SaveHeaderFooter": false, // 保存当前子文档下的主文档的页眉页脚
                    "SaveOriginHeaderFooter": false // 保存子文档时是否包含子文档原来的页眉和页脚
                }
                newXml = ctl.SaveSubDocumentToString(options);
            }
            ctl.DCExecuteCommand('filenew');
        }

        var newXml = '';
        function insert() {
            console.log(newXml)
            var file = new Array();
            file.push(newXml ? newXml : xml);  //构造两个选项分别对应两个子文档
            var options = new Array();
            var attr1 = {
                "Attributes": {
                    "姓名": "张三",
                    "科室": "胸外科",
                    "床号": "12345"
                }, //自定义属性
                "NewPage": "false", //子文档标题
                "ReadOnly": "false", //是否可编辑
                "Title": "张三的病程记录", //文档标题
                "ID": "subdoc1",//
                "ToolTip": "sdsd",//光标提示内容
                //"CSSStyle": "border:  3px solid #FF0000; background-color: #FFFF00;", //自定义的样式
                "TitleLevel": "0",//导航级别，从0到7的整数
                "Parameters": {
                    "fieldTime": "2020-09-09  15:12:13",
                    "fieldMedic": "王二麻子"
                } //绑定的数据格式
            };
            options.push(attr1);
            var options = {
                Files: file,
                Options: options,
                Usebase64: "false"
            };
            ctl.AppendSubDocuments(options);
        }


        var xml = `<XTextDocument xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" EditorVersionString="1.2020.5.13">
   <XElements>
      <Element xsi:type="XTextHeader">
         <InnerID>740</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag" StyleIndex="0">
               <InnerID>745</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextBody">
         <InnerID>741</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XInputField" StyleIndex="0">
               <Attributes>
                  <Attribute>
                     <Name>SetUnderline</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>DataSourceName</Name>
                     <Value>记录日期时间</Value>
                  </Attribute>
                  <Attribute>
                     <Name>dicCode</Name>
                  </Attribute>
                  <Attribute>
                     <Name>sourceFileName</Name>
                  </Attribute>
                  <Attribute>
                     <Name>isHidden</Name>
                     <Value>True</Value>
                  </Attribute>
                  <Attribute>
                     <Name>qianmingbiaozhi</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>zhenduanshuxingleixing</Name>
                  </Attribute>
                  <Attribute>
                     <Name>shoushubiaoshi</Name>
                     <Value>0</Value>
                  </Attribute>
               </Attributes>
               <InnerID>260</InnerID>
               <ID>1673424705577uqhmgzol</ID>
               <ToolTip>请选择记录日期时间</ToolTip>
               <EnableValueValidate>true</EnableValueValidate>
               <ValueBinding>
                  <DataSource>RiChangBCJL</DataSource>
                  <BindingPath>JiLuRQSJ</BindingPath>
               </ValueBinding>
               <Deleteable>false</Deleteable>
               <BorderElementColor />
               <BackgroundTextColor>#000000</BackgroundTextColor>
               <MoveFocusHotKey>None</MoveFocusHotKey>
               <Name>日期时间</Name>
               <DisplayFormat>
                  <Style>DateTime</Style>
                  <Format>yyyy-MM-dd HH:mm</Format>
               </DisplayFormat>
               <BackgroundText>记录日期时间</BackgroundText>
               <FieldSettings>
                  <EditStyle>DateTime</EditStyle>
               </FieldSettings>
            </Element>
            <Element xsi:type="XParagraphFlag" StyleIndex="1">
               <InnerID>261</InnerID>
            </Element>
            <Element xsi:type="XParagraphFlag" StyleIndex="1">
               <InnerID>263</InnerID>
            </Element>
            <Element xsi:type="XString" StyleIndex="1">
               <InnerID>773</InnerID>
               <Text>    </Text>
            </Element>
            <Element xsi:type="XInputField" StyleIndex="1">
               <Attributes>
                  <Attribute>
                     <Name>SetUnderline</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>dicCode</Name>
                  </Attribute>
                  <Attribute>
                     <Name>DataSourceName</Name>
                     <Value>住院病程</Value>
                  </Attribute>
                  <Attribute>
                     <Name>sourceFileName</Name>
                  </Attribute>
                  <Attribute>
                     <Name>isHidden</Name>
                     <Value>True</Value>
                  </Attribute>
                  <Attribute>
                     <Name>qianmingbiaozhi</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>zhenduanshuxingleixing</Name>
                  </Attribute>
                  <Attribute>
                     <Name>shoushubiaoshi</Name>
                     <Value>0</Value>
                  </Attribute>
               </Attributes>
               <InnerID>269</InnerID>
               <ID>1673424733241glkhpuzf</ID>
               <ToolTip>请输入住院病程</ToolTip>
               <EnableValueValidate>true</EnableValueValidate>
               <ValueBinding>
                  <DataSource>RiChangBCJL</DataSource>
                  <BindingPath>ZhuYuanBC</BindingPath>
               </ValueBinding>
               <ContentReadonly>False</ContentReadonly>
               <XElements>
                  <Element xsi:type="XString" StyleIndex="1">
                     <InnerID>774</InnerID>
                     <Text>患者 ，华成国，67岁。因“反复颈肩部疼痛1个月，加重5天。”入院。现以颈肩部疼痛，颈椎活动轻度受限，肩部活动轻度受限，心前区疼痛，头晕、头痛，上肢麻木，胸闷、心悸，腹部不适，四诊合参，本病当属祖国医学“痹病”范畴，舌质暗，苔厚腻，脉弦，疼痛固定，疼痛性质呈刺痛，证属淤血症。                                                  证候诊断：瘀血症                                           西医诊断：1、颈肩综合征                                                           2、颈痛                                                            3、肢体麻木                                                       4、心前区疼痛</Text>
                  </Element>
               </XElements>
               <Deleteable>false</Deleteable>
               <StartBorderText>[</StartBorderText>
               <EndBorderText>]</EndBorderText>
               <BorderElementColor />
               <Name>住院病程</Name>
               <InnerValue>患者 ，华成国，67岁。因“反复颈肩部疼痛1个月，加重5天。”入院。现以颈肩部疼痛，颈椎活动轻度受限，肩部活动轻度受限，心前区疼痛，头晕、头痛，上肢麻木，胸闷、心悸，腹部不适，四诊合参，本病当属祖国医学“痹病”范畴，舌质暗，苔厚腻，脉弦，疼痛固定，疼痛性质呈刺痛，证属淤血症。                                                  证候诊断：瘀血症                                           西医诊断：1、颈肩综合征                                                           2、颈痛                                                            3、肢体麻木                                                       4、心前区疼痛</InnerValue>
               <BackgroundText>住院病程</BackgroundText>
            </Element>
            <Element xsi:type="XParagraphFlag" StyleIndex="1">
               <InnerID>712</InnerID>
            </Element>
            <Element xsi:type="XParagraphFlag" StyleIndex="1">
               <InnerID>714</InnerID>
            </Element>
            <Element xsi:type="XInputField" StyleIndex="1">
               <Attributes>
                  <Attribute>
                     <Name>SetUnderline</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>dicCode</Name>
                  </Attribute>
                  <Attribute>
                     <Name>DataSourceName</Name>
                     <Value>医师签名</Value>
                  </Attribute>
                  <Attribute>
                     <Name>sourceFileName</Name>
                  </Attribute>
                  <Attribute>
                     <Name>isHidden</Name>
                     <Value>True</Value>
                  </Attribute>
                  <Attribute>
                     <Name>qianmingbiaozhi</Name>
                     <Value>0</Value>
                  </Attribute>
                  <Attribute>
                     <Name>zhenduanshuxingleixing</Name>
                  </Attribute>
                  <Attribute>
                     <Name>shoushubiaoshi</Name>
                     <Value>0</Value>
                  </Attribute>
               </Attributes>
               <InnerID>716</InnerID>
               <ID>1673424763697ywvpuism</ID>
               <ToolTip>请输入医师签名</ToolTip>
               <EnableValueValidate>true</EnableValueValidate>
               <ValueBinding>
                  <DataSource>RiChangBCJL</DataSource>
                  <BindingPath>YiShiQM</BindingPath>
               </ValueBinding>
               <ContentReadonly>False</ContentReadonly>
               <Deleteable>false</Deleteable>
               <StartBorderText>[</StartBorderText>
               <EndBorderText>]</EndBorderText>
               <BorderElementColor />
               <Name>医师签名</Name>
               <BackgroundText>医师签名</BackgroundText>
            </Element>
            <Element xsi:type="XParagraphFlag" StyleIndex="2">
               <InnerID>717</InnerID>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextFooter">
         <InnerID>742</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag">
               <InnerID>747</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
   </XElements>
   <SerializeParameterValue>true</SerializeParameterValue>
   <UserHistories>
      <History>
         <ID>276608082462724096</ID>
         <Name>罗莹莹</Name>
         <SavedTime>2023-03-17T19:28:42.0593908+08:00</SavedTime>
         <PermissionLevel>1</PermissionLevel>
         <ClientName>123</ClientName>
      </History>
   </UserHistories>
   <ContentStyles>
      <Default xsi:type="DocumentContentStyle">
         <FontSize>12</FontSize>
      </Default>
      <Styles>
         <Style Index="0">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <BorderWidth>1</BorderWidth>
            <CreatorIndex>0</CreatorIndex>
         </Style>
         <Style Index="1">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <CreatorIndex>0</CreatorIndex>
         </Style>
         <Style Index="2">
            <FontName>宋体</FontName>
            <FontSize>12</FontSize>
            <Align>Right</Align>
            <CreatorIndex>0</CreatorIndex>
         </Style>
      </Styles>
   </ContentStyles>
   <Info>
      <LicenseText>浙江普沃:电子病历</LicenseText>
      <CreationTime>1980-01-01T00:00:00</CreationTime>
      <LastModifiedTime>2023-03-17T19:28:42.0612298+08:00</LastModifiedTime>
      <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
      <Operator>DCSoft.Writer Version:1.2020.5.13</Operator>
      <NumOfPage>1</NumOfPage>
   </Info>
   <BodyText>

    [患者 ，华成国，67岁。因“反复颈肩部疼痛1个月，加重5天。”入院。现以颈肩部疼痛，颈椎活动轻度受限，肩部活动轻度受限，心前区疼痛，头晕、头痛，上肢麻木，胸闷、心悸，腹部不适，四诊合参，本病当属祖国医学“痹病”范畴，舌质暗，苔厚腻，脉弦，疼痛固定，疼痛性质呈刺痛，证属淤血症。                                                  证候诊断：瘀血症                                           西医诊断：1、颈肩综合征                                                           2、颈痛                                                            3、肢体麻木                                                       4、心前区疼痛]

[]</BodyText>
   <LocalConfig />
   <PageSettings>
      <StrictUsePageSize>false</StrictUsePageSize>
   </PageSettings>
</XTextDocument>`


    </script>
</body>
</html >
