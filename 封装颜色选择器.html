<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
            box-sizing: border-box;
        }

        #colorBox1 {
            width: 10px;
            height: 10px;
            background: #ff0000;
            display: block;
        }
    </style>
</head>

<body>
    <div>
        <div id="colorBox1"></div>
    </div>

    <script>
        function createdColorPicker(colorParentDiv, callback, currentColor = "#FFFFFF", isColor = false) {
            // 获取最近使用颜色
            var colorRecentlyUsed = localStorage.getItem('colorRecentlyUsed') || '';
            var colorRecentlyUsedArr = colorRecentlyUsed ? JSON.parse(colorRecentlyUsed) : [];
            if (colorParentDiv) {
                colorParentDiv.innerHTML = colorPickerHTML;
                var styleDIV = document.createElement('style');
                styleDIV.innerHTML = colorPickerSTYLE;
                colorParentDiv.appendChild(styleDIV);

                // 渲染最近使用的颜色
                var RecentlyUsedDiv = document.querySelectorAll('#recentlyUsedDom>.dc_color_box');
                if (colorRecentlyUsedArr && colorRecentlyUsedArr.length) {
                    colorRecentlyUsedArr.reverse();//倒序最近颜色
                    for (var i = 0; i <= colorRecentlyUsedArr.length; i++) {
                        RecentlyUsedDiv[i] && (RecentlyUsedDiv[i].style['background-color'] = colorRecentlyUsedArr[i]);
                    }
                }
            }


            //当前正在使用的颜色复显
            var dc_color_picker_show_color = document.querySelector('#dc_color_picker_show_color');
            dc_color_picker_show_color.style['background-color'] = currentColor;
            dc_color_picker_show_color.innerHTML = currentColor;

            // 颜色选择
            var dcColorPicker = document.getElementById('dc_color_picker');
            dcColorPicker.addEventListener('click', function (e) {
                e.stopPropagation();
                if (e.target.classList.contains('dc_color_box')) {
                    var colorString = e.target.style['background-color'] || '';
                    //删除已经选中的颜色
                    var prevColorChoose = document.querySelector('.dc_color_choose_active');
                    if (prevColorChoose) {
                        prevColorChoose.classList.remove('dc_color_choose_active');
                    }
                    //选中当前颜色
                    e.target.classList.add('dc_color_choose_active');


                    //计算带有透明度值的颜色
                    var alphaInput = document.getElementById('alpha');
                    var colorStringWithAlpha = colorToHexWithAlpha(colorString, alphaInput.value);
                    if (e.target.classList.contains('dc_color_picker_default')) {
                        // 默认色选择
                        colorStringWithAlpha = isColor ? "#000000" : "#FFFFFF";
                        alphaInput.value = 1;
                    }
                    //设置当前颜色
                    var dc_color_picker_show_color = document.querySelector('#dc_color_picker_show_color');
                    dc_color_picker_show_color.style['background-color'] = colorStringWithAlpha;
                    dc_color_picker_show_color.innerHTML = colorStringWithAlpha;

                    //防止有重复颜色
                    var setcolorRecentlyUsedArr = colorRecentlyUsed ? JSON.parse(colorRecentlyUsed) : [];
                    if (setcolorRecentlyUsedArr.indexOf(colorString) !== -1) {
                        var index = setcolorRecentlyUsedArr.indexOf(colorString);
                        setcolorRecentlyUsedArr.splice(index, 1);
                    }
                    // 始终只保留最近10次使用的颜色
                    if (setcolorRecentlyUsedArr.length >= 10) {
                        setcolorRecentlyUsedArr.shift();
                    }
                    setcolorRecentlyUsedArr.push(colorString);
                    localStorage.setItem('colorRecentlyUsed', JSON.stringify(setcolorRecentlyUsedArr));//保存颜色
                    // callback && callback(colorString);
                }
            });

            // 透明度
            var alphaInput = document.getElementById('alpha');
            var alphaValue = document.getElementById('alphaValue');
            //透明度复显
            var alpha = 1;
            //rgba颜色
            if (currentColor.startsWith('rgba')) {
                //rgba
                let values = currentColor.substring(currentColor.indexOf('(') + 1, currentColor.lastIndexOf(')')).split(',');
                alpha = parseFloat(values[3]);
            } else if (currentColor.startsWith('#') && currentColor.length === 9) {
                //#RRGGBBAA
                let alphaHex = currentColor.substring(7);
                if (alphaHex && alphaHex.length) {
                    alpha = parseInt(alphaHex, 16) / 255;
                }
            }
            alphaInput.value = alpha;
            alphaValue.innerHTML = (alpha * 100).toFixed(0) + '%';
            alphaInput.addEventListener('input', function () {
                alphaValue.innerHTML = (this.value * 100).toFixed(0) + '%';
                var newColorString = null;
                //当前展示的颜色
                var dc_color_picker_show_color = document.querySelector('#dc_color_picker_show_color');
                var currentColor = dc_color_picker_show_color.innerHTML;
                newColorString = colorToHexWithAlpha(currentColor, this.value);
                if (newColorString) {
                    //设置当前颜色
                    var dc_color_picker_show_color = document.querySelector('#dc_color_picker_show_color');
                    dc_color_picker_show_color.style['background-color'] = newColorString;
                    dc_color_picker_show_color.innerHTML = newColorString;
                }
            });

            //取消
            var dc_color_picker_cancel = document.querySelector('#dc_color_picker_standard_cancel');
            dc_color_picker_cancel.addEventListener('click', function () {
                var colorPicker = document.getElementById('dc_color_picker');
                if (colorPicker) {
                    colorPicker && (colorPicker.parentNode['style']['display'] = 'none');
                    colorPicker.parentNode.removeChild(colorPicker);
                }
                // 遮罩层
                var colorDialogBox = document.getElementById('colorDialogBox');
                if (colorDialogBox) {
                    colorDialogBox.style.display = 'none';
                }
            });

            //确认
            var dc_color_picker_standard_confirm = document.querySelector('#dc_color_picker_standard_confirm');
            dc_color_picker_standard_confirm.addEventListener('click', function () {
                // var 
                callback && callback(dc_color_picker_show_color.innerHTML);
                dc_color_picker_cancel.click();
            });
        }
        //js颜色和透明度计算后的16进制颜色
        function colorToHexWithAlpha(color, opacity = 1) {
            if (color.startsWith('#')) {
                let r = parseInt(color.slice(1, 3), 16);
                let g = parseInt(color.slice(3, 5), 16);
                let b = parseInt(color.slice(5, 7), 16);
                let alphaHex = Math.round(opacity * 255).toString(16).padStart(2, '0');
                return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}${alphaHex}`;
            }

            if (color.startsWith('rgba')) {
                let values = color.substring(color.indexOf('(') + 1, color.lastIndexOf(')')).split(',');
                let r = parseInt(values[0]);
                let g = parseInt(values[1]);
                let b = parseInt(values[2]);
                let alphaHex = Math.round(opacity * 255).toString(16).padStart(2, '0');
                var colorString = `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}${alphaHex}`;
                // colorString = colorString.toString().toLocaleUpperCase();
                return colorString;
            }

            const rgbRegex = /^rgb\(\s*\d+\s*,\s*\d+\s*,\s*\d+\s*\)$/i;
            if (rgbRegex.test(color)) {
                let values = color.substring(color.indexOf('(') + 1, color.lastIndexOf(')')).split(',');
                let r = parseInt(values[0]);
                let g = parseInt(values[1]);
                let b = parseInt(values[2]);
                let hex = ((r << 16) + (g << 8) + b).toString(16).padStart(6, '0');
                let alphaHex = Math.round(opacity * 255).toString(16).padStart(2, '0');
                var colorString = `#${hex}${alphaHex}`;
                return colorString;
            }

            return '无法识别的颜色格式';
        }

        var colorPickerHTML = `
        <div id="dc_color_picker" class="dc_color_picker">
            <div class="dc_color_picker_default dc_color_box">默认</div>
            <div class="dc_color_picker_choose">
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #f2f0f3;"></div>
                    <div class="dc_color_box" style="background-color: #dad8db;"></div>
                    <div class="dc_color_box" style="background-color: #bfbdc0;"></div>
                    <div class="dc_color_box" style="background-color: #a5a3a6;"></div>
                    <div class="dc_color_box" style="background-color: #959396;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #010002;"></div>
                    <div class="dc_color_box" style="background-color: #7f7d80;"></div>
                    <div class="dc_color_box" style="background-color: #5b595c;"></div>
                    <div class="dc_color_box" style="background-color: #3f3d40;"></div>
                    <div class="dc_color_box" style="background-color: #272527;"></div>
                    <div class="dc_color_box" style="background-color: #09070a;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #4b5265;"></div>
                    <div class="dc_color_box" style="background-color: #f5f3f6;"></div>
                    <div class="dc_color_box" style="background-color: #cac7cf;"></div>
                    <div class="dc_color_box" style="background-color: #86889e;"></div>
                    <div class="dc_color_box" style="background-color: #262427;"></div>
                    <div class="dc_color_box" style="background-color: #212024;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #3f71fc;"></div>
                    <div class="dc_color_box" style="background-color: #e6effb;"></div>
                    <div class="dc_color_box" style="background-color: #cadbfd;"></div>
                    <div class="dc_color_box" style="background-color: #a0befc;"></div>
                    <div class="dc_color_box" style="background-color: #2253ba;"></div>
                    <div class="dc_color_box" style="background-color: #182f76;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #3ca4f3;"></div>
                    <div class="dc_color_box" style="background-color: #e4faf8;"></div>
                    <div class="dc_color_box" style="background-color: #d0edff;"></div>
                    <div class="dc_color_box" style="background-color: #a5dcfe;"></div>
                    <div class="dc_color_box" style="background-color: #2d74a0;"></div>
                    <div class="dc_color_box" style="background-color: #18405b;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #469959;"></div>
                    <div class="dc_color_box" style="background-color: #edf8f0;"></div>
                    <div class="dc_color_box" style="background-color: #cbe5d4;"></div>
                    <div class="dc_color_box" style="background-color: #a2d6b4;"></div>
                    <div class="dc_color_box" style="background-color: #337c4f;"></div>
                    <div class="dc_color_box" style="background-color: #27472f;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #d63733;"></div>
                    <div class="dc_color_box" style="background-color: #fce7ec;"></div>
                    <div class="dc_color_box" style="background-color: #f9c9c9;"></div>
                    <div class="dc_color_box" style="background-color: #f6979a;"></div>
                    <div class="dc_color_box" style="background-color: #941d15;"></div>
                    <div class="dc_color_box" style="background-color: #4c110b;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #e98209;"></div>
                    <div class="dc_color_box" style="background-color: #faf3eb;"></div>
                    <div class="dc_color_box" style="background-color: #f9dcc3;"></div>
                    <div class="dc_color_box" style="background-color: #f6b785;"></div>
                    <div class="dc_color_box" style="background-color: #ae6203;"></div>
                    <div class="dc_color_box" style="background-color: #5b2d0c;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #efc500;"></div>
                    <div class="dc_color_box" style="background-color: #f8f9e0;"></div>
                    <div class="dc_color_box" style="background-color: #ffefa9;"></div>
                    <div class="dc_color_box" style="background-color: #fce261;"></div>
                    <div class="dc_color_box" style="background-color: #998208;"></div>
                    <div class="dc_color_box" style="background-color: #5c5006;"></div>
                </div>
                <div class="dc_color-group">
                    <div class="dc_color_box" style="background-color: #9631dd;"></div>
                    <div class="dc_color_box" style="background-color: #fbeafb;"></div>
                    <div class="dc_color_box" style="background-color: #edc9fd;"></div>
                    <div class="dc_color_box" style="background-color: #cd8eff;"></div>
                    <div class="dc_color_box" style="background-color: #54288f;"></div>
                    <div class="dc_color_box" style="background-color: #371347;"></div>
                </div>
            </div>
            <div id="dc_color_picker_show_color" ></div>
            <div class="dc_color_picker_standard">
                <div class="dc_color_picker_standard_text">标准色</div>
                <div class="dc_color_picker_standard_choose">
                    <div class="dc_color_box" style="background-color: #af0308;"></div>
                    <div class="dc_color_box" style="background-color: #f10300;"></div>
                    <div class="dc_color_box" style="background-color: #f7c003;"></div>
                    <div class="dc_color_box" style="background-color: #fffb00;"></div>
                    <div class="dc_color_box" style="background-color: #9cd04a;"></div>
                    <div class="dc_color_box" style="background-color: #37b246;"></div>
                    <div class="dc_color_box" style="background-color: #39b1f7;"></div>
                    <div class="dc_color_box" style="background-color: #2372b6;"></div>
                    <div class="dc_color_box" style="background-color: #0d1d63;"></div>
                    <div class="dc_color_box" style="background-color: #6a319b;"></div>
                </div>
            </div>
            <div class="dc_color_picker_standard">
                <div class="dc_color_picker_standard_text" style="margin-bottom: 0;">透明度(<span id="alphaValue">100%</span>):</div>
                <input type="range" id="alpha" min="0" max="1" step="0.01" value="1">
            </div>
            <div class="dc_color_picker_standard">
                <div class="dc_color_picker_standard_text">最近使用</div>
                <div class="dc_color_picker_standard_choose" id="recentlyUsedDom">
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                    <div class="dc_color_box" style="background-color: #ffffff;"></div>
                </div>
            </div>
            <div class="dc_color_picker_standard dc_color_picker_standard_btn">
                <div id="dc_color_picker_standard_cancel">取消</div>
                <div id="dc_color_picker_standard_confirm">确认</div>
            </div>
        </div>`;
        var colorPickerSTYLE = `
        .dc_color_picker_standard_btn{
            display: flex;
            justify-content: flex-end;
            margin-top: 20px;
            align-items: center;
        }
        #dc_color_picker_standard_cancel{
            margin-right: 10px;
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: #fff;
            cursor: pointer;
            font-size: 10px;
        }
        #dc_color_picker_standard_cancel:hover{
            border-color: #409eff;
            color: #409eff;
        }
        #dc_color_picker_standard_confirm{
            padding: 4px 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            background: #1890ff;
            color: #409eff;
            background: #ecf5ff;
            border-color: #b3d8ff;
        }
        #dc_color_picker_standard_confirm:hover{
            color: #fff;
            background-color: #409eff;
            border-color: #409eff;
        }
        #dc_color_picker_show_color{
            width: 100%;
            height: 26px;
            border: 1px solid #ebebeb;
            text-align: center;
            line-height: 26px;
            font-size: 14px;
            color: #FFFFFF;
        }
        .dc_color_choose_active{
            border: 2px solid #1890ff;
            box-shadow: 0 0 6px 0 #606266;

        }
        #alpha{
            width: 100%;
            margin-top: 10px;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
           background:linear-gradient(45deg,transparent,black);
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 10px;
            height: 16px;
            background: gray;
            cursor: pointer;
            border-radius:1px;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            background:gray;
        }

        input[type="range"]::-webkit-slider-thumb:active {
            background:gray;
        }
        .color-picker-choose-box {
            width: 100%;
            height: 20px;
            border: 1px solid #ccc;
            cursor: pointer;
            position: relative;
            background: linear-gradient(to right, gray,black,blue,red,yellow,green,white);
        }

        .color-picker-choose-box .colorPickerChooseSelector {
            width: 16px;
            height: 16px;
            border: 1px solid #fff;
            position: absolute;
            top: 1px;
            left: 0;
            box-shadow: 0 0 5px 0 #fff;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        .color-picker-opacity-box{
            width: 100%;
            height: 20px;
            background: linear-gradient(to right, rgba(0, 0, 0, 1),rgba(0, 0, 0, 0));
            margin-top: 10px;
            position: relative;
            cursor: pointer;
        }
        .colorPickerOpacitySelector{
            width: 10px;
            height: 20px;
            background: #333;
            position: absolute;
            top: 0;
            left: 0;
            transition: all 0.3s ease;
        }
   
        .dc_color_picker {
            width: 260px;
            background: #ffffff;
            padding: 10px;
            box-sizing: border-box;
            margin: 0;
            box-shadow: 0 0 8px 0 rgba(232, 237, 250, .6), 0 2px 4px 0 rgba(232, 237, 250, .5);
            position:fixed;
        }

        .dc_color_picker_default.dc_color_box {
            width: 100%;
            height: 26px;
            border: 1px solid #ebebeb;
            text-align: center;
            line-height: 26px;
            font-size: 14px;
            color: #606266;
        }

        .dc_color_picker_choose {
            width: 100%;
            height: 136px;
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .dc_color-group {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .dc_color_box {
            width: 18px;
            height: 18px;
            border: 1px solid #ebebeb;
            cursor: pointer;
        }

        .dc_color_picker_standard_text {
            margin: 6px 0;
            font-size: 14px;
            color: #606266;
        }

        .dc_color_picker_standard_choose {
            width: 100%;
            display: flex;
            justify-content: space-between;
        }`;
    </script>
    <script>
        var colorBox = document.getElementById('colorBox1');
        createdColorPicker(colorBox, function (colorStr) {
            console.log(colorStr);
            colorBox.style.backgroundColor = colorStr;
        }, '#ff0000', true);
    </script>
</body>

</html>