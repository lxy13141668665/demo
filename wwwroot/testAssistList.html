<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试辅助录入</title>
    <link222 href="DCSoft.WASM.styles.css" rel="stylesheet"></link222>
    <link href="./js/easyui/easyui.css" rel="stylesheet" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
        }

        #tools {
            padding: 5px 10px;
            height: 120px;
            overflow: auto;
        }

        #main {
            height: calc(100% - 120px);
            overflow: hidden;
        }

        #main #dcwriter {
            border: 1px solid #000;
        }
    </style>
</head>

<body>
    <div id="tools">
        <div>
            <b style="font-size: 16px;">辅助录入相关属性：</b>
            <div>启用辅助输入字符串属性：myEditControl.DocumentOptions.BehaviorOptions.AutoAssistInsertString = true;</div>
            <div>启用自动辅助输入文本时的检测长度：myEditControl.DocumentOptions.BehaviorOptions.AutoAssistInsertStringDetectTextLength =
                2;</div>
        </div>
        <button onclick="document.getElementById('dcwriter').DCExecuteCommand('fileopen')">编辑器打开本地文件</button>
        <a href="#" title="打开" class="easyui-linkbutton" data-options="plain:true" onclick="fileOpen()">打开</a>
    </div>
    <div id="main">
        <div id="dcwriter" dctype="WriterControlForWASM" DoubleBuffer="true"
            RegisterCode="0596ACE69CFEDA6049E2B0AB8F61A6EB77417D43048C94F2FEC8EF188B9F93701356B484E51E9866F5FD1DAEDC05CD9C2B2694D07C132CF9D337145FA6CB9F6747F7F7EF73B16233788DDA65604DF01EFC278900F153FA0D11E07190CFC337455B2DF88227863E0AF4A2552FED42C1C1DE42100AF3704910FFA04DACDFC5B90484CB99A1DDEB665398B3BAD2A1434DF5AB8E1A10D57C6621BAF3FC4F20366B0086"
            ServicePageUrl="http://www.dcwriter.cn:8099/ServicePage.aspx" PrintServicePageUrl="http://localhost:23345"
            style="height: 100%; background-color: rgb(230, 230, 230); border-bottom: 0px solid black; background-attachment: fixed; background-size: cover; background-position: center top; "
            RuleVisible="true" RuleBackColor="rgb(230, 230, 230)" PageCssString222="box-shadow:3px 3px 3px grey"
            DocumentOptions.BehaviorOptions.HandleCommandException="false"
            DocumentOptions.BehaviorOptions.OutputFormatedXMLSource="false"
            DocumentOptions.BehaviorOptions.ParagraphFlagFollowTableOrSection="true"
            DocumentOptions.ViewOptions.EnableEncryptView="true"
            DocumentOptions.ViewOptions.ShowInputFieldStateTag="true"
            DocumentOptions.ViewOptions.IgnoreFieldBorderWhenPrint="false"
            DocumentOptions.ViewOptions.PrintBackgroundText="false"
            DocumentOptions.ViewOptions.PreserveBackgroundTextWhenPrint="true"
            DocumentOptions.ViewOptions.FieldBorderPrintVisibility="hidden"
            DocumentOptions.ViewOptions.FieldInvalidateValueForeColor="Blue"
            DocumentOptions.ViewOptions.TagColorForNormalField="Green"
            DocumentOptions.ViewOptions.TagColorForValueInvalidateField="Blue"
            DocumentOptions.ViewOptions.UnEditableFieldBorderColor="Yellow"
            DocumentOptions.SecurityOptions.EnablePermission="true"
            DocumentOptions.SecurityOptions.EnableLogicDelete="true"
            DocumentOptions.SecurityOptions.ShowLogicDeletedContent="true"
            DocumentOptions.SecurityOptions.ShowPermissionTip="true"
            DocumentOptions.SecurityOptions.ShowPermissionMark="true" PageTitlePosition="BottomRight"
            DocumentOptions.BehaviorOptions.AutoAssistInsertString="true"
            OnLoadA="this.LoadDocumentFromString(strDemoFileXml, 'xml');">正在加载...</div>
    </div>
    </div>
</body>
<script src="js/easyui/easyui.js"></script>
<script src="_framework/blazor.webassembly.js"></script>
<script>
    // 打开本地文件
    function fileOpen() {
        var ctl = document.getElementById("dcwriter");
        let file = document.createElement('input');
        file.setAttribute('id', 'dcInputFile');
        file.setAttribute('type', 'file');
        file.setAttribute('accept', '.xml,.json,.rtf,.html,.htm,.odt');
        file.style.display = 'none';
        ctl.appendChild(file);
        file.click();
        //file文件选中事件
        file.onchange = function () {
            let fileList = this.files;
            if (fileList.length > 0) {
                console.log(fileList[0]);
                let reader = new FileReader();
                reader.readAsText(fileList[0], "UFT-8");
                reader.onload = function (e) {
                    //获取到文件内容
                    let strFileContent = e.target.result;
                    //获取文件格式
                    let fileFormat = "xml";
                    var fileName = '新建文档';
                    fileFormat = fileList[0].name.substring(fileList[0].name.lastIndexOf(".") + 1);
                    fileName = fileList[0].name.substring(0, fileList[0].name.lastIndexOf("."));
                    ctl.LoadDocumentFromString(strFileContent, fileFormat);
                }
            }
        }
        //在编辑器的window重新获取焦点时,确保点击取消或X时能正确删除file
        window.addEventListener('focus', function () {
            setTimeout(function () {
                if (file.parentNode == ctl) {
                    ctl.removeChild(file);
                }
            }, 100);
        }, { once: true });
    }
</script>
<script>
    var strDemoFileXml;
    var AssistListArr = [];//辅助快速录入数据存储位置
    getAssistList();
    // 编辑器加载成功
    function WriterControl_OnLoad(rootElement) {
        console.log("WriterControl_OnLoad：编辑器加载成功");
    };
    // 辅助录入触发事件
    function WriterControl_EventQueryAssistInputItems(rootElement, args) {
        // 添加这个是因为这个事件会触发两次，需要检查
        if (!args || typeof (args) != "object" || !args.Items) {
            return;
        }
        var PreWord = args.PreWord;//获取的前面几个文字
        if (PreWord && PreWord.length > 0) {
            // 异步加载数据
            args.Async = true;
            window.setTimeout(function () {
                // 赋值
                //  辅助录入项的过滤
                args.Items = AssistListArr.filter(function (item) {
                    return item && typeof (item) == "string" && item.indexOf(PreWord) == 0;
                });
                args.Complete();
            }, 100);
        }
    }
    // 获取辅助快速录入项目
    function getAssistList() {
        var UrlStr = "static/辅助快速录入项目.txt";
        $.ajax({
            url: UrlStr,
            dataType: "text",
            success: function (res) {
                if (res && res.length > 0) {
                    AssistListArr = res.split("\r\n");
                }
            }
        });
    }
</script>

</html>