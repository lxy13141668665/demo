<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>DCSoft.WASM</title>
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/app.css" rel="stylesheet" />
    <link222 href="DCSoft.WASM.styles.css" rel="stylesheet"></link222>
   
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
        }
        #tt {
            height: calc(100% - 161px);
            overflow: hidden;
            background-color: white;
        }
        .tabs-panels {
            height: calc(100% - 34px);
        }
        .tabs-panels>.panel-htop, .panel-body {
            height: 100%;
        }
        .tabs-title-change::after {
            content: '*';
            margin-left: 5px;
        }
        .colour {
            background-color: yellow;
        }
    </style>
   
</head>

<body style="text-align:center;">
    <div style="text-align:left;border-bottom:1px solid black">
        <button onclick="GetCurrentWriterControl().ShowAboutDialog()">ÂÖ≥‰∫é</button>
        <button onclick="GetCurrentWriterControl().ClearContent()">Êñ∞Âª∫</button>
        <button onclick="FileOpen()">ÊâìÂºÄ</button>
        <button onclick="DownLoad('xml')">‰∏ãËΩΩXML</button>
        <button onclick="Refresh()">Âà∑Êñ∞</button>
        <br />
        <button onclick="TestHorizontalExpanding()">ÂØπÂΩìÂâçÂçïÂÖÉÊ†ºËÆæÁΩÆËÉåÊôØËâ≤</button>
    </div>

    <div id="myWriterControl"
         dctype="WriterControlForWASM"
         style="height: 100%; background-color: rgb(177, 202, 235); border-bottom: 1px solid black;background-image: url(Workspace-Background.png); background-attachment: fixed; background-size: cover; background-position: center top; "
         RuleVisible="true" AllowDrop="true" AllowDragContent="true"
         RuleBackColor="rgb(155, 187, 227)"
         ServicePageUrl="http://www.dcwriter.cn:6788/ServicePage.aspx"
         PageCssString222="box-shadow:1px 1px 1px grey"
         DocumentOptions.BehaviorOptions.OutputFormatedXMLSource="false"
         DocumentOptions.BehaviorOptions.ParagraphFlagFollowTableOrSection="true"
         DocumentOptions.ViewOptions.ShowInputFieldStateTag="true"
         DocumentOptions.ViewOptions.IgnoreFieldBorderWhenPrint="false"
         DocumentOptions.ViewOptions.PrintBackgroundText="false"
         DocumentOptions.ViewOptions.PreserveBackgroundTextWhenPrint="true"
         DocumentOptions.ViewOptions.FieldBorderPrintVisibility="hidden"
         DocumentOptions.ViewOptions.FieldInvalidateValueForeColor="Blue"
         DocumentOptions.ViewOptions.TagColorForNormalField="Green"
         DocumentOptions.ViewOptions.TagColorForValueInvalidateField="Blue"
         DocumentOptions.ViewOptions.UnEditableFieldBorderColor="Yellow"
         DocumentOptions.SecurityOptions.EnablePermission="true"
         DocumentOptions.SecurityOptions.EnableLogicDelete="true"
         DocumentOptions.SecurityOptions.ShowLogicDeletedContent="true"
         DocumentOptions.SecurityOptions.ShowPermissionTip="true"
         DocumentOptions.SecurityOptions.ShowPermissionMark="true"
         OnLoad="this.LoadDocumentFromString(strs, 'xml');">Ê≠£Âú®Âä†ËΩΩ...</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">üóô</a>
    </div>
    <div style="text-align:left;background-color:lightblue;border-bottom:1px solid black">Áä∂ÊÄÅÔºö<span id="lblStatus">...</span></div>   
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="DemoApp.js"></script>    
    <script src="js/jquery-1.7.2.min.js"></script>
    <script language="javascript">
        /**Ëé∑ÂæóÂΩìÂâçÁöÑÁºñËæëÂô®Êéß‰ª∂ÂØπË±° */
        function GetCurrentWriterControl() {
            return document.getElementById("myWriterControl");
        }
        function FileOpen() {
            let file = document.createElement('input');
            file.setAttribute('id', 'dcInputFile');
            file.setAttribute('type', 'file');
            file.setAttribute('accept', '.xml,.json,.rtf,.html,.htm');
            file.style.display = 'none';
            myWriterControl.appendChild(file);
            file.click();
            //fileÊñá‰ª∂ÈÄâ‰∏≠‰∫ã‰ª∂
            file.onchange = function () {
                let fileList = this.files;
                if (fileList.length > 0) {
                    console.log(fileList[0]);
                    let reader = new FileReader();
                    reader.readAsText(fileList[0], "UFT-8");
                    reader.onload = function (e) {
                        //Ëé∑ÂèñÂà∞Êñá‰ª∂ÂÜÖÂÆπ
                        let strFileContent = e.target.result;
                        //Ëé∑ÂèñÊñá‰ª∂Ê†ºÂºè
                        let fileFormat = "xml";
                        var fileName = 'Êñ∞Âª∫ÊñáÊ°£';
                        fileFormat = fileList[0].name.substring(fileList[0].name.lastIndexOf(".") + 1)
                        fileName = fileList[0].name.substring(0, fileList[0].name.lastIndexOf("."));
                        let ctl = document.getElementById("myWriterControl");                        
                        //window.CreateWriterControlForWASM(newCtl);
                        ctl.LoadDocumentFromString(strFileContent, fileFormat);
                    }
                }
            }
        }
        function DownLoad(format) {
            if (format == null || format == "") {
                format = "xml";
            }
            let ctl = document.getElementById("myWriterControl");
            ctl.DownLoadFile(format);
        }
        function Refresh() {
            let ctl = document.getElementById("myWriterControl");
            ctl.RefreshDocument();
        }

        function TestHorizontalExpanding() {
            var myWriterControl = document.getElementById("myWriterControl");
            var cell = myWriterControl.CurrentTableCell();
            if (cell != null) {
                var opt = {
                    Style: {
                        BackgroundColorString: "yellow"
                    }
                };
                myWriterControl.SetElementProperties(cell, opt);
            }
        }

        function processArr(arr) {
            if (Array.isArray(arr) === false) {
                return;
            }
            for (var i = 0; i < arr.length; i++) {
                var item = arr[i];
                if (typeof (item) !== "object") {
                    continue;
                }
                for (var key in item) {
                    if (Array.isArray(item[key]) === true) {
                        processArr(item[key]);
                    } else if (item[key] == null) {
                        item[key] = " ";
                    }
                }
            }
        }

        /**
         * Êéß‰ª∂Âä†ËΩΩÂÆåÊØïÂêé‰ºöËá™Âä®ÊâßË°åÂêç‰∏∫ WriterControl_OnLoad ÁöÑÂáΩÊï∞.ËØ•ÂáΩÊï∞ÂÜÖÁöÑthisÂèòÈáèÊåáÂêëHTMLÊ†πÂÖÉÁ¥†
         * @param { WriterControl } rootElement
         */
        function WriterControl_OnLoad(rootElement) {
            console.log('WriterControl_OnLoad')
            
            rootElement.SelectionChanged = function (eventSender, args) {
                var txt =
                    "Á¨¨" + (this.FocusedPageIndexBase0 + 1) + "È°µ,Á¨¨" +
                    this.CurrentLineIndexInPage + "Ë°åÔºåÁ¨¨" +
                    this.CurrentColumnIndex + "Âàó.";
                if (this.SelectionLength != 0) {
                    txt = txt + "ÈÄâÊã©‰∫Ü" +
                        Math.abs(this.SelectionLength) + "‰∏™ÂÖÉÁ¥†";
                }
                var p = this.SelectionStartPosition;
                txt = txt + " X:" + p.x + " Y:" + p.y;
                document.getElementById('lblStatus').innerText =
                    txt + " ÂΩìÂâçÂ≠ó‰Ωì:" + this.CurrentFontName + "," + this.CurrentFontSize;
            };
            rootElement.DocumentLoad = function (eventSender, args) {
                //LogHightTime("Êñá‰ª∂Âä†ËΩΩÂÆåÊØï");
            };
            rootElement.EventShowContextMenu = Handle_EventShowContextMenu;// Ëøô‰∏™ÂáΩÊï∞ÂÆö‰πâÂú®DemoApp.js‰∏≠
            rootElement.EventUpdateToolarState = Handle_EventUpdateToolarState;// Ëøô‰∏™ÂáΩÊï∞ÂÆö‰πâÂú®DemoApp.js‰∏≠
        };
        /** ÊñáÊ°£ÂÜÖÂÆπÂèëÁîüÊîπÂèò‰∫ã‰ª∂*/
        function WriterControl_DocumentContentChanged(rootElement) {
            //console.log(rootElement.id + " ÂÜÖÂÆπÂèëÁîüÊîπÂèò");
            //var pp = $('#tt').tabs('getSelected');
            //var tab = pp.panel('options').tab;
            //var titleEle = tab[0].querySelector('.tabs-title');
            //titleEle.classList.add('tabs-title-change');
            //titleEle.classList.remove('tabs-title-change');
        };
        var strs = `<XTextDocument xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" EditorVersionString="0.0.0.0">
   <XElements>
      <Element xsi:type="XTextHeader">
         <InnerID>1</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag" StyleIndex="0">
               <InnerID>6</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextBody">
         <InnerID>2</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XTextTable" NumOfRows="1" NumOfColumns="1">
               <InnerID>11</InnerID>
               <ID>table1</ID>
               <XElements>
                  <Element xsi:type="XTextTableRow">
                     <InnerID>13</InnerID>
                     <XElements>
                        <Element xsi:type="XTextTableCell" StyleIndex="1">
                           <InnerID>14</InnerID>
                           <XElements>
                              <Element xsi:type="XString">
                                 <InnerID>32</InnerID>
                                 <Text>sdfdsfdsfsdfdsf</Text>
                              </Element>
                              <Element xsi:type="XParagraphFlag" StyleIndex="2">
                                 <InnerID>15</InnerID>
                              </Element>
                           </XElements>
                        </Element>
                     </XElements>
                  </Element>
               </XElements>
               <Columns>
                  <Element xsi:type="XTextTableColumn">
                     <InnerID>12</InnerID>
                     <Width>1874.75</Width>
                  </Element>
               </Columns>
            </Element>
            <Element xsi:type="XParagraphFlag">
               <InnerID>7</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
      <Element xsi:type="XTextFooter">
         <InnerID>3</InnerID>
         <AcceptTab>true</AcceptTab>
         <XElements>
            <Element xsi:type="XParagraphFlag">
               <InnerID>8</InnerID>
               <AutoCreate>true</AutoCreate>
            </Element>
         </XElements>
      </Element>
   </XElements>
   <ContentStyles>
      <Default xsi:type="DocumentContentStyle">
         <FontSize>12</FontSize>
      </Default>
      <Styles>
         <Style Index="0">
            <FontSize>12</FontSize>
            <Align>Center</Align>
         </Style>
         <Style Index="1">
            <FontSize>12</FontSize>
            <BorderWidth>1</BorderWidth>
            <BorderLeft>true</BorderLeft>
            <BorderBottom>true</BorderBottom>
            <BorderTop>true</BorderTop>
            <BorderRight>true</BorderRight>
            <PaddingLeft>15</PaddingLeft>
            <PaddingTop>10</PaddingTop>
            <PaddingRight>15</PaddingRight>
            <PaddingBottom>10</PaddingBottom>
         </Style>
         <Style Index="2">
            <FontSize>12</FontSize>
            <Align>Center</Align>
         </Style>
      </Styles>
   </ContentStyles>
   <Info>
      <LicenseText>ÈÉΩÊòå:ÈÉΩÊòåÊóóËà∞ÁâàÔºà100Âπ∂ÂèëÔºâ</LicenseText>
      <CreationTime>2023-07-31T18:38:50.8897994+08:00</CreationTime>
      <LastModifiedTime>2023-07-31T18:39:37.958357+08:00</LastModifiedTime>
      <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
      <Operator>DCSoft.Writer Version:0.0.0.0</Operator>
      <NumOfPage>1</NumOfPage>
   </Info>
   <BodyText>sdfdsfdsfsdfdsf </BodyText>
   <LocalConfig />
   <PageSettings>
      <StrictUsePageSize>false</StrictUsePageSize>
   </PageSettings>
</XTextDocument>`;
    </script>
</body>

</html>
