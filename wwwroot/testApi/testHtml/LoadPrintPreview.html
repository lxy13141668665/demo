<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <title></title>
    <base href="/" target="_blank">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            padding: 0px;
            box-sizing: border-box;
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            height: 100%;
        }

        .header-box {
            border-bottom: 1px solid #ccc;
            padding-left: 10px;
            box-sizing: border-box;
            font-weight: 900;
        }

        #main {
            padding: 10px;
            box-sizing: border-box;
            display: block;
            flex: 1;
            overflow: hidden;
        }

        .testButton {
            cursor: pointer;
            height: 24px;
            width: 80px;
            border-radius: 4px;
            color: #fff;
            line-height: 24px;
            text-align: center;
            background-color: #208c99;
            font-size: 14px;
            margin-left: 24px;
        }
    </style>


</head>

<body>
    <div class="container">
        <div class="header-box">
            <button onclick="GetCurrentWriterControl().ShowAboutDialog()">关于</button>
            <button onclick="ClearContent()">清空</button>
            <button onclick="FileNew()">新建</button>
            <button onclick="FileOpen()">打开</button>
            <button onclick="Refresh()">刷新</button>
            <button onclick="DownLoadFile('xml');">下载xml</button>

            <br />
            <button onclick="LoadPrintPreviewWithPermissionMark()">展示打印预览界面</button>
            <input type="button" value="LoadPrintPreview" onclick="LoadPrintPreview();" />
            <input type="button" value="关闭打印预览" onclick="ClosePrintPreview();" />
            <input type="button" value="IsPrintPreview" onclick="IsPrintPreview();" />
            <button class="easyui-linkbutton" data-options="plain:true" dccommandName="JumpPrintMode">续打模式</button>
            <button class="easyui-linkbutton" data-options="plain:true"
                dccommandName="OffsetJumpPrintMode">偏移续打模式</button>
            <button onclick="printPreviewHtml()" class="colour">合并打印</button>
            <button onclick="PrintOdd();">打印奇数页</button>
            <button onclick="PrintEven();">打印偶数页</button>
            <button onclick="LocalPrint();">本地打印</button>
            <button onclick="PrintAsHtml()">打印Html</button>
            <button onclick="PrintAsPdf()">打印pdf</button>
            <button onclick="PrintCurrentPage()">打印当前页</button>



            <br />
            <button onclick="SetJumpPrintMode(true)">续打模式true</button>
            <button onclick="SetJumpPrintMode(false)">续打模式false</button>
            <button onclick="JumpPrint()">获取续打信息</button>
            <button onclick="JumpPrintEndPosition()">获取打印结束的位置</button>
            <button onclick="setJumpPrintEndPosition()">设置打印结束的位置</button>
            <button onclick="JumpPrintPosition()">获取续打的位置</button>
            <button onclick="setJumpPrintPosition()">设置续打的位置</button>
            <button onclick="GetPrintResult()">打印结果</button>
            <button onclick="LastPrintResult()">最后一次打印结果</button>
            <br />
            <button onclick="SetElementPrintVisibility()">设置元素的是否打印的属性</button>



        </div>
        <div id="main">
            <div id="myWriterControl" dctype="WriterControlForWASM"
                style="height: 100%; background-color: rgb(230, 230, 230); border-bottom: 0px solid black; background-attachment: fixed; background-size: cover; background-position: center top; "
                RuleVisible="true" RuleBackColor="rgb(230, 230, 230)"
                ServicePageUrl="http://www.dcwriter.cn:8099/ServicePage.aspx"
                PageCssString222="box-shadow:3px 3px 3px grey"
                DocumentOptions.BehaviorOptions.OutputFormatedXMLSource="false"
                DocumentOptions.BehaviorOptions.ParagraphFlagFollowTableOrSection="true"
                DocumentOptions.ViewOptions.ShowInputFieldStateTag="true"
                DocumentOptions.ViewOptions.IgnoreFieldBorderWhenPrint="false"
                DocumentOptions.ViewOptions.PrintBackgroundText="false"
                DocumentOptions.ViewOptions.PreserveBackgroundTextWhenPrint="true"
                DocumentOptions.ViewOptions.FieldBorderPrintVisibility="hidden"
                DocumentOptions.ViewOptions.FieldInvalidateValueForeColor="Blue"
                DocumentOptions.ViewOptions.TagColorForNormalField="Green"
                DocumentOptions.ViewOptions.TagColorForValueInvalidateField="Blue"
                DocumentOptions.ViewOptions.UnEditableFieldBorderColor="Yellow"
                DocumentOptions.SecurityOptions.EnablePermission="true"
                DocumentOptions.SecurityOptions.EnableLogicDelete="true"
                DocumentOptions.SecurityOptions.ShowLogicDeletedContent="true"
                DocumentOptions.SecurityOptions.ShowPermissionTip="true"
                DocumentOptions.SecurityOptions.ShowPermissionMark="true">
                正在加载...</div>
        </div>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="../../js/jquery-1.7.2.min.js"></script>
    <script language="javascript">
        function SetJumpPrintMode(type) {
            var ctl = document.getElementById("myWriterControl");
            var result = ctl.SetJumpPrintMode(type);
        }

        function LoadPrintPreview() {
            let ctl = document.getElementById('myWriterControl')
            ctl.LoadPrintPreview()
        }
        function ClosePrintPreview() {
            let ctl = document.getElementById('myWriterControl')
            ctl.ClosePrintPreview()
        }
        function IsPrintPreview() {
            let ctl = document.getElementById('myWriterControl')
            var result = ctl.IsPrintPreview();
            alert("返回值：" + result);
        }

        function GetPrintResult() {
            var myWriterControl = GetCurrentWriterControl();
            var result = myWriterControl.GetPrintResult();
            if (result != null) {

                var message = "PageIndexFix:" + result.PageIndexFix;
                message += (",PageCount:" + result.PageCount);
                message += (",LastPageHeight:" + result.LastPageHeight);
                message += (",BodyOffsetY:" + result.BodyOffsetY);
                message += (",BodyHeight:" + result.BodyHeight);
                alert("打印结果：" + message);
            }
            else {
                alert("未获取到打印结果");
            }
        }
        function LastPrintResult() {
            var myWriterControl = GetCurrentWriterControl();
            var result = myWriterControl.LastPrintResult;
            if (result != null) {

                var message = "PageIndexFix:" + result.PageIndexFix;
                message += (",PageCount:" + result.PageCount);
                message += (",LastPageHeight:" + result.LastPageHeight);
                message += (",BodyOffsetY:" + result.BodyOffsetY);
                message += (",BodyHeight:" + result.BodyHeight);
                alert("最后一次打印结果：" + message);
            }
            else {
                alert("未获取到打印结果");
            }
        }
        //合并打印html
        function printPreviewHtml() {
            let ctl = document.getElementById("myWriterControl");
            var options = {
                Files: [
                    [`<XTextDocument xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" EditorVersionString="1.2023.4.28">
               <XElements>
                  <Element xsi:type="XTextHeader">
                     <InnerID>3556</InnerID>
                     <AcceptTab>true</AcceptTab>
                     <XElements>
                        <Element xsi:type="XParagraphFlag" StyleIndex="0">
                           <InnerID>3562</InnerID>
                           <AutoCreate>true</AutoCreate>
                        </Element>
                     </XElements>
                  </Element>
                  <Element xsi:type="XTextBody">
                     <InnerID>3557</InnerID>
                     <AcceptTab>true</AcceptTab>
                     <XElements>
                        <Element xsi:type="XString">
                           <InnerID>3584</InnerID>
                           <Text>这是测试页面</Text>
                        </Element>
                        <Element xsi:type="XParagraphFlag">
                           <InnerID>3561</InnerID>
                           <AutoCreate>true</AutoCreate>
                        </Element>
                     </XElements>
                  </Element>
                  <Element xsi:type="XTextFooter">
                     <InnerID>3558</InnerID>
                     <AcceptTab>true</AcceptTab>
                     <XElements>
                        <Element xsi:type="XParagraphFlag">
                           <InnerID>3563</InnerID>
                           <AutoCreate>true</AutoCreate>
                        </Element>
                     </XElements>
                  </Element>
               </XElements>
               <ContentStyles>
                  <Default xsi:type="DocumentContentStyle">
                     <FontName>宋体</FontName>
                     <FontSize>12</FontSize>
                  </Default>
                  <Styles>
                     <Style Index="0">
                        <FontName>宋体</FontName>
                        <FontSize>12</FontSize>
                        <Align>Center</Align>
                     </Style>
                  </Styles>
               </ContentStyles>
               <Info>
                  <LicenseText>南京都昌信息科技有限公司内部使用:南京都昌信息科技有限公司内测旗舰版</LicenseText>
                  <CreationTime>1980-01-01T00:00:00</CreationTime>
                  <LastModifiedTime>2023-05-25T08:47:35.1352338+08:00</LastModifiedTime>
                  <LastPrintTime>1980-01-01T00:00:00</LastPrintTime>
                  <Operator>DCSoft.Writer Version:1.2023.4.28</Operator>
                  <NumOfPage>1</NumOfPage>
               </Info>
               <BodyText>这是测试页面</BodyText>
               <LocalConfig />
               <PageSettings>
                  <StrictUsePageSize>false</StrictUsePageSize>
               </PageSettings>
</XTextDocument>`],

                ],
                UseBase64: "false",
                WaterMark: {
                    Type: "Text",
                    Text: "aaaaaaaaaaa",
                    Repeat: "True",
                    ImageDataBase64String: null,
                    Font: "Tahoma, 12, style=Italic",
                    DensityForRepeat: "0.2",
                    ColorValue: "#1A3E72",
                    BackColorValue: "White",
                    Angle: "30",
                    Alpha: "80"
                }
            }
            var printHtml = ctl.GetPrintPreviewHTMLByMixedFiles(options);
            ctl.PrintPreviewByHtml(printHtml);
        }
        function BindCommand() {
            var elements = document.getElementsByTagName("button");
            for (var iCount = 0; iCount < elements.length; iCount++) {
                var element = elements[iCount];
                var cmdName = element.getAttribute("dccommandName");
                if (cmdName != null && cmdName.length > 0) {
                    if (element.onclick == null) {
                        element.onclick = function () {
                            GetCurrentWriterControl().DCExecuteCommand(this.getAttribute("dccommandName"), true, null);
                        };
                    }
                }
            }
        };
        BindCommand();

        function JumpPrint() {
            let ctl = document.getElementById("myWriterControl");
            console.log("续打JumpPrint: ", ctl.JumpPrint)
            alert('请在控制台查看')
        }
        function JumpPrintEndPosition() {
            let ctl = document.getElementById("myWriterControl");
            alert("续打结束位置: " + ctl.JumpPrintEndPosition)
        }
        function setJumpPrintEndPosition() {
            var index = prompt("请输入续打结束位置：", "")
            let ctl = document.getElementById("myWriterControl");
            try {
                ctl.JumpPrintEndPosition = Number(index)
                alert('设置成功')
            } catch (error) {
                alert('设置失败')

            }
        }

        function JumpPrintPosition() {
            let ctl = document.getElementById("myWriterControl");
            alert("续打位置: " + ctl.JumpPrintPosition)
        }
        function setJumpPrintPosition() {
            var index = prompt("请输入续打位置：", "")
            let ctl = document.getElementById("myWriterControl");
            try {
                ctl.JumpPrintPosition = Number(index)
                alert('设置成功')
            } catch (error) {
                alert('设置失败')

            }
        }
        function PrintOdd() {
            var ctl = GetCurrentWriterControl();
            let CreatePrintOptions =
            {
                PrintMode: "EvenPage",//由于是0开始，所以奇偶数颠倒
                CleanMode: true
            };
            ctl.PrintDocument(CreatePrintOptions);
        }
        function PrintEven() {
            var ctl = GetCurrentWriterControl();
            let CreatePrintOptions =
            {
                PrintMode: "OddPage",//由于是0开始，所以奇偶数颠倒
                CleanMode: true
            };
            ctl.PrintDocument(CreatePrintOptions);
        }
        function PrintAsHtml() {
            var ctl = document.getElementById("myWriterControl");
            ctl.PrintAsHtml(null, function (a) {
                ctl.PrintByHtml(a);
            });
        }
        function PrintAsPdf() {
            var ctl = document.getElementById("myWriterControl");
            ctl.PrintAsPDF(null, function (a) { console.log(a) });
        }
        function PrintCurrentPage() {
            let ctl = document.getElementById("myWriterControl");
            let CreatePrintOptions =
            {
                CleanMode: true,// 默认为空，是否为整洁打印模式，可选值为true:整洁打印，false:留痕打印，空：采用编辑器当前的留痕显示设置。
                PrintRange: "CurrentPage",// 默认AllPages,打印范围，为一个字符串，可以为 AllPages,Selection,SomePages,CurrentPage
                PrintMode: "Normal",// 默认Normal,打印模式，为一个字符串，可以为 Normal,OddPage,EvenPage。这里的页码是从0开始计算的。
                Collate: true,// 默认false,是否为逐份打印，为一个布尔值
                Copies: 1,// 默认1,打印份数，为一个整数。
                FromPage: 0, // 默认0，从0开始计算的打印开始页码，只有PrintRange=SomePages时本设置才有效
                ToPage: 1,//默认为总页数, 从0开始计算的打印结束开始页码，只有PrintRange=SomePages时本设置才有效
                SpecifyPageIndexs: "1"//默认空，打印指定页码列表，页码从0开始计算，各个项目之间用逗号分开，如果项目中间有个横杠，表示一个页码范围
            };


            ctl.PrintDocument(CreatePrintOptions);
        }

        function LocalPrint() {

            var printserver = "http://localhost:8181";
            var name = prompt("请输入本地打印服务地址：）：", printserver)
            if (name != null && name != "") {

                let ctl = GetCurrentWriterControl();
                var options = {
                    ShowUI: false,  //是否弹出打印对话框
                    PrinterName: null,  //自定义打印机名称，若为空则选择默认打印机
                    PrintPageRange: "all",  //支持格式"2,5-7,9"等混合格式
                    OffsetY: 0,
                    AutoFitPageSize: true,
                    CleanMode: true,
                    ManualDuplex: false,
                    Files: null,   //为空则打印当前文档，可设为二维数组支持混合合并文档打印
                    JumpPrintPosition: null,
                    JumpPrintEndPosition: null

                };
                ctl.setAttribute("PrintServicePageUrl", name);
                ctl.LocalPrintDocuments(options, function (args) {
                    console.log(args);
                });
            }
        }


        function LoadPrintPreviewWithPermissionMark() {
            let ctl = document.getElementById("myWriterControl");
            ctl.LoadPrintPreview({ CleanMode: false });
        }
        function SetElementPrintVisibility() {
            var ctl = document.getElementById("myWriterControl");
            var input = ctl.CurrentInputField();

            var result = ctl.SetElementPrintVisibility(input, "Hidden");
        }
        function WriterControl_OnLoad(rootElement) {

        }
        function ClearContent() {
            var ctl = document.getElementById("myWriterControl");
            var result = ctl.ClearContent();
            console.log(result);
        }
        function FileNew() {
            var ctl = document.getElementById("myWriterControl");
            var result = ctl.DCExecuteCommand("FileNew", false, null);
            console.log(result);
        }
        function FileOpen() {
            var ctl = document.getElementById("myWriterControl");
            ctl.DCExecuteCommand("FileOpen", true, null);
        }
        /**获得当前的编辑器控件对象 */
        function GetCurrentWriterControl() {
            return document.getElementById("myWriterControl");
        }
        function Refresh() {
            let ctl = document.getElementById("myWriterControl");
            ctl.RefreshDocument();
        }
        function DownLoadFile(format) {
            if (format == null || format == "") {
                format = "xml";
            }
            if (format == 'doc') {
                DownLoadFiledoc();
            }
            else {
                let ctl = GetCurrentWriterControl();
                ctl.DownLoadFile(format);
            }

        }

    </script>
</body>

</html>