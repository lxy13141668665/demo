<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script language="javascript" src="../js/jquery-1.7.2.min.js"></script>
</head>
<body>
    <input type="button" value="清空内容" onclick="GetCurrentWriterControl().ClearDocument();" />
    <input type="button" value="追加一个文档" onclick="OpenFile();" />
    <input type="button" value="打印全部" onclick="GetCurrentWriterControl().PrintDocument();" />
    <span>页码</span>
    <select id="ctlPageIndex" onchange="GetCurrentWriterControl().MoveToPage(this.value);"></select>
    <div id="myWriterControl"
         dctype="WriterPrintPreviewControlForWASM"
         DoubleBuffer="true"
         RegisterCode="0596ACE69CFEDA6049E2B0AB8F61A6EB77417D43048C94F2FEC8EF188B9F93701356B484E51E9866F5FD1DAEDC05CD9C2B2694D07C132CF9D337145FA6CB9F6747F7F7EF73B16233788DDA65604DF01EFC278900F153FA0D11E07190CFC337455B2DF88227863E0AF4A2552FED42C1C1DE42100AF3704910FFA04DACDFC5B90484CB99A1DDEB665398B3BAD2A1434DF5AB8E1A10D57C6621BAF3FC4F20366B0086"
         ServicePageUrl="http://www.dcwriter.cn:8099/ServicePage.aspx"
         PrintServicePageUrl="http://localhost:23345"
         style="height:800px; background-color: rgb(230, 230, 230); border-bottom: 0px solid black; background-attachment: fixed; background-size: cover; background-position: center top; "
         RuleVisible="true"
         RuleBackColor33="rgb(230, 230, 230)"
         PageCssString222="box-shadow:3px 3px 3px grey"
         DocumentOptions.BehaviorOptions.AutoAssistInsertString="true"
         DocumentOptions.BehaviorOptions.AutoAssistInsertStringDetectTextLength="1"
         DocumentOptions.BehaviorOptions.HandleCommandException="false"
         DocumentOptions.BehaviorOptions.OutputFormatedXMLSource="false"
         DocumentOptions.BehaviorOptions.ParagraphFlagFollowTableOrSection="true"
         DocumentOptions.ViewOptions.EnableEncryptView="true"
         DocumentOptions.ViewOptions.ShowInputFieldStateTag="true"
         DocumentOptions.ViewOptions.IgnoreFieldBorderWhenPrint="false"
         DocumentOptions.ViewOptions.PrintBackgroundText="false"
         DocumentOptions.ViewOptions.PreserveBackgroundTextWhenPrint="true"
         DocumentOptions.ViewOptions.FieldBorderPrintVisibility="hidden"
         DocumentOptions.ViewOptions.FieldInvalidateValueForeColor="Blue"
         DocumentOptions.ViewOptions.TagColorForNormalField="Green"
         DocumentOptions.ViewOptions.TagColorForValueInvalidateField="Blue"
         DocumentOptions.ViewOptions.UnEditableFieldBorderColor="Yellow"
         DocumentOptions.SecurityOptions.EnablePermission="true"
         DocumentOptions.SecurityOptions.EnableLogicDelete="true"
         DocumentOptions.SecurityOptions.ShowLogicDeletedContent="true"
         DocumentOptions.SecurityOptions.ShowPermissionTip="true"
         DocumentOptions.SecurityOptions.ShowPermissionMark="true"
         PageTitlePosition="BottomRight">正在加载...</div>
    <span>############################</span>
    <script src33="../_framework/dcwriter5.js"
            src4="http://localhost:5000/MyWriter/WASMFileDownload?wasmres=dcwriter5.js"
            src666="http://localhost:9901/dcwriter5svp.aspx?wasmres=dcwriter5.js"
            src="http://localhost/ASPNETDemo/dcwriter5svp.aspx?wasmres=dcwriter5.js"></script>

    <script language="javascript">
        function GetCurrentWriterControl() {
            return document.getElementById("myWriterControl");
        }
        function OpenFile() {
            var myWriterControl = GetCurrentWriterControl();
            let file = document.createElement('input');
            file.setAttribute('id', 'dcInputFile');
            file.setAttribute('type', 'file');
            file.setAttribute('accept', '.xml,.json,.rtf,.html,.htm,.odt');
            file.style.display = 'none';
            myWriterControl.appendChild(file);
            file.click();
            //file文件选中事件
            file.onchange = function () {
                let fileList = this.files;
                if (fileList.length > 0) {
                    console.log(fileList[0]);
                    let reader = new FileReader();
                    reader.readAsText(fileList[0], "UFT-8");
                    reader.onload = function (e) {
                        //获取到文件内容
                        let strFileContent = e.target.result;
                        myWriterControl.AddDocumentByText(strFileContent, "xml");
                        myWriterControl.InvalidatePreview();
                        var pIndexs = myWriterControl.GetAllPageIndexs();
                        if (pIndexs != null) {
                            var cbo = document.getElementById("ctlPageIndex");
                            while (cbo.firstChild != null) {
                                cbo.removeChild(cbo.firstChild);
                            }
                            for (var iCount = 0; iCount < pIndexs.length; iCount++) {
                                var opt = document.createElement("option");
                                opt.textContent = pIndexs[iCount];
                                opt.value = pIndexs[iCount];
                                cbo.appendChild(opt);
                            }
                        }
                    }
                }
            }
            //在编辑器的window重新获取焦点时,确保点击取消或X时能正确删除file
            window.addEventListener('focus', function () {
                setTimeout(function () {
                    if (file.parentNode == myWriterControl) {
                        myWriterControl.removeChild(file);
                    }
                }, 100);
            }, { once: true })
        }
    </script>
</body>
</html>